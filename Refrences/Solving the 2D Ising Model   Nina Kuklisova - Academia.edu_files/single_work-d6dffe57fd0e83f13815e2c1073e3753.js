+function(t){"use strict";function e(){var t=document.createElement("bootstrap"),e={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var o in e)if(void 0!==t.style[o])return{end:e[o]};return!1}t.fn.emulateTransitionEnd=function(e){var o=!1,n=this;t(this).one("bsTransitionEnd",function(){o=!0});var r=function(){o||t(n).trigger(t.support.transition.end)};return setTimeout(r,e),this},t(function(){t.support.transition=e(),t.support.transition&&(t.event.special.bsTransitionEnd={bindType:t.support.transition.end,delegateType:t.support.transition.end,handle:function(e){return t(e.target).is(this)?e.handleObj.handler.apply(this,arguments):void 0}})})}(jQuery),+function(t){"use strict";function e(e){return this.each(function(){var n=t(this),r=n.data("bs.collapse"),i=t.extend({},o.DEFAULTS,n.data(),"object"==typeof e&&e);!r&&i.toggle&&"show"==e&&(e=!e),r||n.data("bs.collapse",r=new o(this,i)),"string"==typeof e&&r[e]()})}var o=function(e,n){this.$element=t(e),this.options=t.extend({},o.DEFAULTS,n),this.transitioning=null,this.options.parent&&(this.$parent=t(this.options.parent)),this.options.toggle&&this.toggle()};o.VERSION="3.2.0",o.DEFAULTS={toggle:!0},o.prototype.dimension=function(){var t=this.$element.hasClass("width");return t?"width":"height"},o.prototype.show=function(){if(!this.transitioning&&!this.$element.hasClass("in")){var o=t.Event("show.bs.collapse");if(this.$element.trigger(o),!o.isDefaultPrevented()){var n=this.$parent&&this.$parent.find("> .panel > .in");if(n&&n.length){var r=n.data("bs.collapse");if(r&&r.transitioning)return;e.call(n,"hide"),r||n.data("bs.collapse",null)}var i=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[i](0),this.transitioning=1;var a=function(){this.$element.removeClass("collapsing").addClass("collapse in")[i](""),this.transitioning=0,this.$element.trigger("shown.bs.collapse")};if(!t.support.transition)return a.call(this);var s=t.camelCase(["scroll",i].join("-"));this.$element.one("bsTransitionEnd",t.proxy(a,this)).emulateTransitionEnd(350)[i](this.$element[0][s])}}},o.prototype.hide=function(){if(!this.transitioning&&this.$element.hasClass("in")){var e=t.Event("hide.bs.collapse");if(this.$element.trigger(e),!e.isDefaultPrevented()){var o=this.dimension();this.$element[o](this.$element[o]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse").removeClass("in"),this.transitioning=1;var n=function(){this.transitioning=0,this.$element.trigger("hidden.bs.collapse").removeClass("collapsing").addClass("collapse")};return t.support.transition?(this.$element[o](0).one("bsTransitionEnd",t.proxy(n,this)).emulateTransitionEnd(350),void 0):n.call(this)}}},o.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()};var n=t.fn.collapse;t.fn.collapse=e,t.fn.collapse.Constructor=o,t.fn.collapse.noConflict=function(){return t.fn.collapse=n,this},t(document).on("click.bs.collapse.data-api",'[data-toggle="collapse"]',function(o){var n,r=t(this),i=r.attr("data-target")||o.preventDefault()||(n=r.attr("href"))&&n.replace(/.*(?=#[^\s]+$)/,""),a=t(i),s=a.data("bs.collapse"),l=s?"toggle":r.data(),c=r.attr("data-parent"),u=c&&t(c);s&&s.transitioning||(u&&u.find('[data-toggle="collapse"][data-parent="'+c+'"]').not(r).addClass("collapsed"),r[a.hasClass("in")?"addClass":"removeClass"]("collapsed")),e.call(a,l)})}(jQuery),+function(t){"use strict";function e(e,n){return this.each(function(){var r=t(this),i=r.data("bs.modal"),a=t.extend({},o.DEFAULTS,r.data(),"object"==typeof e&&e);i||r.data("bs.modal",i=new o(this,a)),"string"==typeof e?i[e](n):a.show&&i.show(n)})}var o=function(e,o){this.options=o,this.$body=t(document.body),this.$element=t(e),this.$backdrop=this.isShown=null,this.scrollbarWidth=0,this.options.remote&&this.$element.find(".modal-content").load(this.options.remote,t.proxy(function(){this.$element.trigger("loaded.bs.modal")},this))};o.VERSION="3.2.0",o.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},o.prototype.toggle=function(t){return this.isShown?this.hide():this.show(t)},o.prototype.show=function(e){var o=this,n=t.Event("show.bs.modal",{relatedTarget:e});this.$element.trigger(n),this.isShown||n.isDefaultPrevented()||(this.isShown=!0,this.checkScrollbar(),this.$body.addClass("modal-open"),this.setScrollbar(),this.escape(),this.$element.on("click.dismiss.bs.modal",'[data-dismiss="modal"]',t.proxy(this.hide,this)),this.backdrop(function(){var n=t.support.transition&&o.$element.hasClass("fade");o.$element.parent().length||o.$element.appendTo(o.$body),o.$element.show().scrollTop(0),n&&o.$element[0].offsetWidth,o.$element.addClass("in").attr("aria-hidden",!1),o.enforceFocus();var r=t.Event("shown.bs.modal",{relatedTarget:e});n?o.$element.find(".modal-dialog").one("bsTransitionEnd",function(){o.$element.trigger("focus").trigger(r)}).emulateTransitionEnd(300):o.$element.trigger("focus").trigger(r)}))},o.prototype.hide=function(e){e&&e.preventDefault(),e=t.Event("hide.bs.modal"),this.$element.trigger(e),this.isShown&&!e.isDefaultPrevented()&&(this.isShown=!1,this.$body.removeClass("modal-open"),this.resetScrollbar(),this.escape(),t(document).off("focusin.bs.modal"),this.$element.removeClass("in").attr("aria-hidden",!0).off("click.dismiss.bs.modal"),t.support.transition&&this.$element.hasClass("fade")?this.$element.one("bsTransitionEnd",t.proxy(this.hideModal,this)).emulateTransitionEnd(300):this.hideModal())},o.prototype.enforceFocus=function(){t(document).off("focusin.bs.modal").on("focusin.bs.modal",t.proxy(function(t){this.$element[0]===t.target||this.$element.has(t.target).length||this.$element.trigger("focus")},this))},o.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keyup.dismiss.bs.modal",t.proxy(function(t){27==t.which&&this.hide()},this)):this.isShown||this.$element.off("keyup.dismiss.bs.modal")},o.prototype.hideModal=function(){var t=this;this.$element.hide(),this.backdrop(function(){t.$element.trigger("hidden.bs.modal")})},o.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},o.prototype.backdrop=function(e){var o=this,n=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var r=t.support.transition&&n;if(this.$backdrop=t('<div class="modal-backdrop '+n+'" />').appendTo(this.$body),this.$element.on("click.dismiss.bs.modal",t.proxy(function(t){t.target===t.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus.call(this.$element[0]):this.hide.call(this))},this)),r&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!e)return;r?this.$backdrop.one("bsTransitionEnd",e).emulateTransitionEnd(150):e()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");var i=function(){o.removeBackdrop(),e&&e()};t.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one("bsTransitionEnd",i).emulateTransitionEnd(150):i()}else e&&e()},o.prototype.checkScrollbar=function(){document.body.clientWidth>=window.innerWidth||(this.scrollbarWidth=this.scrollbarWidth||this.measureScrollbar())},o.prototype.setScrollbar=function(){var t=parseInt(this.$body.css("padding-right")||0,10);this.scrollbarWidth&&this.$body.css("padding-right",t+this.scrollbarWidth)},o.prototype.resetScrollbar=function(){this.$body.css("padding-right","")},o.prototype.measureScrollbar=function(){var t=document.createElement("div");t.className="modal-scrollbar-measure",this.$body.append(t);var e=t.offsetWidth-t.clientWidth;return this.$body[0].removeChild(t),e};var n=t.fn.modal;t.fn.modal=e,t.fn.modal.Constructor=o,t.fn.modal.noConflict=function(){return t.fn.modal=n,this},t(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(o){var n=t(this),r=n.attr("href"),i=t(n.attr("data-target")||r&&r.replace(/.*(?=#[^\s]+$)/,"")),a=i.data("bs.modal")?"toggle":t.extend({remote:!/#/.test(r)&&r},i.data(),n.data());n.is("a")&&o.preventDefault(),i.one("show.bs.modal",function(t){t.isDefaultPrevented()||i.one("hidden.bs.modal",function(){n.is(":visible")&&n.trigger("focus")})}),e.call(i,a,this)})}(jQuery),function(){this.SingleWork={preview_controller:null,register_preview_view:function(t,e){return this.preview_controller.register_view(t,e)},show_preview:function(t){return this.preview_controller.show(t)},expand_preview:function(){return this.preview_controller.expand()},unexpand_preview:function(){return this.preview_controller.unexpand()}}}.call(this),function(){var t,e={}.hasOwnProperty,o=function(t,o){function n(){this.constructor=t}for(var r in o)e.call(o,r)&&(t[r]=o[r]);return n.prototype=o.prototype,t.prototype=new n,t.__super__=o.prototype,t};SingleWork.AttachmentPreviewController=function(e){function n(){return t=n.__super__.constructor.apply(this,arguments)}return o(n,e),n.prototype.el=".viewable-attachments-select-container",n.prototype.events={"click .preview-attachment-button[data-preview-attachment-id]":"previewLinkClicked"},n.prototype.initialize=function(t){var e;return t.attachment&&(this.attachment=t.attachment,this.updateUI()),t.multiple_viewable_attachments?(e=this,new HoverPopover({el:".viewable-attachments-button",show_delay:200,hide_delay:300,html:!0,content:this.getPopoverContent,on_shown:function(){return e.$popover_el=this.$el}})):void 0},n.prototype.previewLinkClicked=function(t){var e;return e=$(t.currentTarget).data("preview-attachment-id"),this.attachment.id!==e?(this.attachment.id=e,this.attachment.index=$(t.currentTarget).data("preview-attachment-index"),this.updateUI()):void 0},n.prototype.updateUI=function(){return SingleWork.show_preview(this.attachment.id),this.$(".preview-attachment-button[data-preview-attachment-id] .active-attachment-preview").removeClass("active-preview"),$(".work-download-button-container[data-preview-attachment-id]").addClass("hidden"),this.$(".preview-attachment-button[data-preview-attachment-id='"+this.attachment.id+"'] .active-attachment-preview").addClass("active-preview"),$(".work-download-button-container[data-preview-attachment-id='"+this.attachment.id+"']").removeClass("hidden"),this.attachment.title=$(".viewable-attachments-popover-content [data-preview-attachment-id='"+this.attachment.id+"'].preview-attachment-title").first().text(),this.$(".viewable-attachments-preview-index").text(this.attachment.index+1),this.$(".viewable-attachments-preview-title").text(this.attachment.title)},n.prototype.getPopoverContent=function(){return $(".viewable-attachments-popover-content").html()},n}(Backbone.View)}.call(this),function(){SingleWork.CoauthorTagApi=function(){function t(){}return t.accept=function(t,e){return this._setAccepted(t,e,!0)},t.ignore=function(t,e){return this._setAccepted(t,e,!1)},t.reset=function(t,e){return this._setAccepted(t,e,null)},t._setAccepted=function(t,e,o){return $.ajax({type:"PUT",dataType:"json",contentType:"application/json",url:$r.api_v0_work_co_author_tag_path({subdomain_param:"api",id:t,work_id:e}),data:JSON.stringify({accepted:o,coauthor_invite:this._tokenFromUrl()})})},t._tokenFromUrl=function(){var t,e,o,n;return n=$a.decompose_url(window.location.href),o=n[0],t=n[1],e=_.find(t,function(t){return"coauthor_invite"===t[0]}),null!=e?e[1]:void 0},t}()}.call(this),function(){var t,e={}.hasOwnProperty,o=function(t,o){function n(){this.constructor=t}for(var r in o)e.call(o,r)&&(t[r]=o[r]);return n.prototype=o.prototype,t.prototype=new n,t.__super__=o.prototype,t};SingleWork.CoauthorTagIgnoreModal=function(e){function n(){return t=n.__super__.constructor.apply(this,arguments)}return o(n,e),n.prototype.events={"click #coauthor-tag-undo-ignore":"undoIgnore"},n.prototype.show=function(){return this.$el.modal("show"),this},n.prototype.render=function(){return this.$el.modal({show:!1}),this},n.prototype.undoIgnore=function(){return this.$el.modal("hide"),SingleWork.CoauthorTagApi.reset(this.options.tag_id,this.options.work_id),SingleWork.ExternalCoauthorTagModal.open(this.options.tag_id,this.options.work_id)},n}(Backbone.View)}.call(this),function(){var t,e={}.hasOwnProperty,o=function(t,o){function n(){this.constructor=t}for(var r in o)e.call(o,r)&&(t[r]=o[r]);return n.prototype=o.prototype,t.prototype=new n,t.__super__=o.prototype,t};SingleWork.ExternalCoauthorTagModal=function(e){function n(){return t=n.__super__.constructor.apply(this,arguments)}return o(n,e),n.open=function(t,e,o){var n,r;return n=new SingleWork.ExternalCoauthorTagModal({el:".js-coauthor-invite-modal",tag_id:t,work_id:e,coauthor:o}),n.render().show(),r=new SingleWork.ExternalCoauthorTagToolbar({tag_id:t,work_id:e}),$(".work-body-wrapper").prepend(r.render().el)},n.prototype.events={"click .btn-success":"acceptCoauthorRequest"},n.prototype.initialize=function(){var t;return UserSource.remember("coauthor_invite"),t=new c.Server.Notification("coauthor_flow"),t.notify({event:"external_coauthor_invite_modal_render",work_id:this.options.work_id,tag_id:this.options.tag_id}),this.coauthor=this.options.coauthor},n.prototype.show=function(){return this.$el.modal("show"),this},n.prototype.render=function(){return this.$el.modal({show:!1}),this.postRender(),this},n.prototype.postRender=function(){return this.ui={$acceptButtonText:this.$(".js-coauthor-invite-accept-text"),$acceptButtonSpinner:this.$(".js-coauthor-invite-accept-spinner")}},n.prototype.showSignupModal=function(){return this.$el.modal("hide"),$(".coauthor-verify-modal").modal("show")},n.prototype.acceptCoauthorRequest=function(){var t;return t=new c.Server.Notification("coauthor_flow"),t.notify({event:"external_coauthor_invite_accept",work_id:this.options.work_id,tag_id:this.options.tag_id}),this.eligibleForAutoRegister()?this.autoRegisterUser():this.showSignupModal()},n.prototype.eligibleForAutoRegister=function(){var t,e,o,n,r;return null!=(null!=(t=this.coauthor)?t.first_name:void 0)&&null!=(null!=(e=this.coauthor)?e.last_name:void 0)&&null!=(null!=(o=this.coauthor)?o.email:void 0)&&null!=(null!=(n=this.coauthor)?n.token:void 0)&&null!=(null!=(r=this.coauthor)?r.has_emails:void 0)&&this.coauthor.has_emails},n.prototype.autoRegisterUser=function(){var t=this;return this.showAcceptSpinner(),$.ajax({type:"POST",url:"/registrations",data:{user:this.coauthor,no_password:!0,coauthor_token:this.coauthor.token,coauthor_work:this.options.work_id,user_source:"coauthor_invite"},dataType:"json",xhrFields:{withCredentials:!0}}).done(function(e){var o,n,r;return r=e[0],o=e[1],n=e[2],r?document.location.href="/StartRegPath":(t.hideAcceptSpinner(),t.showSignupModal())}).fail(function(){return t.hideAcceptSpinner(),t.showSignupModal()})},n.prototype.hideAcceptSpinner=function(){return this.ui.$acceptButtonText.removeClass("hidden"),this.ui.$acceptButtonSpinner.addClass("hidden")},n.prototype.showAcceptSpinner=function(){return this.ui.$acceptButtonText.addClass("hidden"),this.ui.$acceptButtonSpinner.removeClass("hidden")},n.prototype.alertSuccess=function(){return this.$el.removeClass("alert-warning alert-danger"),this.$el.addClass("alert-success text-center"),this.$(".coauthor-tag-request-prompt").text("You have successfully been added as a co-author!"),this.hideActions()},n.prototype.alertError=function(){return this.$el.removeClass("alert-warning"),this.$el.addClass("alert-danger"),this.$(".coauthor-tag-request-prompt").text("Oops! We encountered an error and failed to process your request.")},n}(Backbone.View)}.call(this),function(){var t,e={}.hasOwnProperty,o=function(t,o){function n(){this.constructor=t}for(var r in o)e.call(o,r)&&(t[r]=o[r]);return n.prototype=o.prototype,t.prototype=new n,t.__super__=o.prototype,t};SingleWork.CoauthorTagSuggestionsModal=function(e){function n(){return t=n.__super__.constructor.apply(this,arguments)}return o(n,e),n.prototype.template="single_work/templates/coauthor_tag_suggestion_modal",n.prototype.initialize=function(){return this.render(),this.show()},n.prototype.render=function(){return this.$el.html(JST[this.template]()),this._postRender(),this},n.prototype._postRender=function(){return this.ui={$modal:this.$(".coauthor-tag-suggestions-modal"),$currentState:this.$(".current-state")}},n.prototype.show=function(){return this.ui.$modal.modal("show")},n.prototype.alertSuccess=function(){return this.ui.$currentState.text("Successfully accepted your co-author suggestions!")},n.prototype.alertError=function(){var t;return t="Oops! We encountered an error while trying to accept your co-author suggestions.",this.ui.$currentState.text(t)},n.prototype.acceptSuggestion=function(){var t=this;return $a.is_logged_in()?$.ajax({type:"POST",dataType:"json",beforeSend:$a.add_csrf_header,contentType:"application/json",url:$r.accept_bundle_api_v0_user_coauthor_tag_suggestions_path({subdomain_param:"api",user_id:$current_user.id,bundle_id:this.options.bundleId}),success:function(){return t.alertSuccess()},error:function(){return t.alertError()}}):void 0},n}(Backbone.View)}.call(this),function(){var t,e={}.hasOwnProperty,o=function(t,o){function n(){this.constructor=t}for(var r in o)e.call(o,r)&&(t[r]=o[r]);return n.prototype=o.prototype,t.prototype=new n,t.__super__=o.prototype,t};SingleWork.CoauthorTagToolbar=function(e){function n(){return t=n.__super__.constructor.apply(this,arguments)}return o(n,e),n.prototype.id="coauthor-tag-request-toolbar",n.prototype.className="coauthor-tag-request-toolbar alert alert-warning clearfix",n.prototype.template="single_work/templates/coauthor_request_toolbar",n.prototype.events={"click .ignore-coauthor-tag-request":"ignoreCoauthorRequest","click .accept-coauthor-tag-request":"acceptCoauthorRequest"},n.prototype.render=function(){return this.$el.html(JST[this.template]()),this},n.prototype.close=function(){return $(".work-body-wrapper").removeClass("coauthor-toolbar-present"),this.remove()},n.prototype.alertSuccess=function(){return this.$el.removeClass("alert-warning alert-danger"),this.$el.addClass("alert-success text-center"),this.$(".coauthor-tag-request-prompt").text("You have successfully been added as a co-author!"),this.hideActions()},n.prototype.alertError=function(){return this.$el.removeClass("alert-warning"),this.$el.addClass("alert-danger"),this.$(".coauthor-tag-request-prompt").text("Oops! We encountered an error and failed to process your request.")},n.prototype.hideActions=function(){return this.$(".coauthor-tag-request-actions").hide()},n.prototype.acceptCoauthorRequest=function(){},n.prototype.ignoreCoauthorRequest=function(){},n}(Backbone.View)}.call(this),function(){SingleWork.CsvView=function(){function t(t){this.container=t.container,this.identifier=t.identifier,this.attachment_id=t.attachment_id,this.$container=$(this.container),this.content=null}return t.prototype.show=function(){var t,e=this;return this.$container.find(".info").hide(),this.$container.find(".csv_preview_loader").show(),null!==this.content?this.$container.html(this.content):(t=$r.attachment_csv_preview_path({attachment_id:this.attachment_id}),$.ajax({url:t,dataType:"json",success:function(t){return e.content=t.content,e.$container.html(e.content)},error:function(){return e.$container.find(".csv_preview_loader").hide(),e.$container.find(".info").show()}}))},t.prototype.expand=function(){return this.$container.addClass("full_width")},t.prototype.unexpand=function(){return this.$container.removeClass("full_width")},t}()}.call(this),function(){var t,e={}.hasOwnProperty,o=function(t,o){function n(){this.constructor=t}for(var r in o)e.call(o,r)&&(t[r]=o[r]);return n.prototype=o.prototype,t.prototype=new n,t.__super__=o.prototype,t};SingleWork.ExternalCoauthorTagToolbar=function(e){function n(){return t=n.__super__.constructor.apply(this,arguments)}return o(n,e),n.prototype.acceptCoauthorRequest=function(){var t;return t=new c.Server.Notification("coauthor_flow"),t.notify({event:"external_coauthor_invite_accept",work_id:this.options.work_id,tag_id:this.options.tag_id}),this.showSignupModal()},n.prototype.ignoreCoauthorRequest=function(){return SingleWork.CoauthorTagApi.ignore(this.options.tag_id,this.options.work_id),this.close()},n.prototype.showSignupModal=function(){return $(".coauthor-verify-modal").modal("show")},n.prototype.render=function(){var t;return UserSource.remember("coauthor_invite"),t=new c.Server.Notification("coauthor_flow"),t.notify({event:"external_coauthor_invite_toolbar_render",work_id:this.options.work_id,tag_id:this.options.tag_id}),n.__super__.render.apply(this,arguments)},n}(SingleWork.CoauthorTagToolbar)}.call(this),function(){SingleWork.IFrameView=function(){function t(t){this.container=t.container,this.identifier=t.identifier,this.$container=$(this.container)}return t.prototype.expand=function(){return this.$container.addClass("full_width")},t.prototype.unexpand=function(){return this.$container.removeClass("full_width")},t}()}.call(this),function(){var t,e={}.hasOwnProperty,o=function(t,o){function n(){this.constructor=t}for(var r in o)e.call(o,r)&&(t[r]=o[r]);return n.prototype=o.prototype,t.prototype=new n,t.__super__=o.prototype,t};SingleWork.InternalCoauthorTagToolbar=function(e){function n(){return t=n.__super__.constructor.apply(this,arguments)}return o(n,e),n.prototype.autoAccept=function(){return this.acceptCoauthorRequest()},n.prototype.acceptCoauthorRequest=function(){var t=this;return $a.is_logged_in()?SingleWork.CoauthorTagApi.accept(this.options.tag_id,this.options.work_id).done(function(){return t.alertSuccess()}).fail(function(){return t.alertError()}):$("#nav_log_in").click()},n.prototype.ignoreCoauthorRequest=function(){var t=this;return $a.is_logged_in()?SingleWork.CoauthorTagApi.ignore(this.options.tag_id,this.options.work_id).done(function(){return t.close()}).fail(function(){return t.alertError()}):$("#nav_log_in").click()},n}(SingleWork.CoauthorTagToolbar)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,o){function n(){this.constructor=e}for(var r in o)t.call(o,r)&&(e[r]=o[r]);return n.prototype=o.prototype,e.prototype=new n,e.__super__=o.prototype,e};SingleWork.RelatedWorks=function(t){function o(){o.__super__.constructor.apply(this,arguments),this.set("works","")}return e(o,t),o.prototype.get_related_works=function(t){var e=this;return $.ajax({url:this._url(t),dataType:"jsonp",success:function(t){return e.set("works",t)}})},o.prototype._url=function(t){return $r.other_works_by_author_api_v0_work_related_works_url({work_id:t.workId,num_works:3})},o}(Backbone.Model)}.call(this),function(){SingleWork.PreviewController=function(){function t(){this.views={},this.current_identifier=null}return t.prototype.show=function(t){return this.current_identifier&&this._hide_view(this.current_identifier),this.current_identifier=t,this._show_view(t)},t.prototype.register_view=function(t,e){if(null!=this.views[t])throw"Can't register multiple views for the same identifier!";return this.views[t]=e,this.current_identifier===t?this._show_view(t):void 0},t.prototype.expand=function(){var t;return null!=(t=this.views[this.current_identifier])?"function"==typeof t.expand?t.expand():void 0:void 0},t.prototype.unexpand=function(){var t;return null!=(t=this.views[this.current_identifier])?"function"==typeof t.unexpand?t.unexpand():void 0:void 0},t.prototype._show_view=function(t){var e;return this._view_container(t).show(),null!=(e=this.views[t])?"function"==typeof e.show?e.show():void 0:void 0},t.prototype._hide_view=function(t){var e;return null!=(e=this.views[t])&&"function"==typeof e.tear_down&&e.tear_down(),this._view_container(t).hide()},t.prototype._view_container=function(t){return $(".attachment_preview[data-attachment="+t+"]")},t}(),SingleWork.preview_controller=new SingleWork.PreviewController}.call(this),function(){var t,e={}.hasOwnProperty,o=function(t,o){function n(){this.constructor=t}for(var r in o)e.call(o,r)&&(t[r]=o[r]);return n.prototype=o.prototype,t.prototype=new n,t.__super__=o.prototype,t};SingleWork.RelatedWorksView=function(e){function n(){return t=n.__super__.constructor.apply(this,arguments)}return o(n,e),n.prototype.el="#related-research-sidebar",n.prototype.template="single_work/templates/related_works",n.prototype.initialize=function(){return this.model=new SingleWork.RelatedWorks,this.model.get_related_works(this.options),this.model.on("change",this.render,this)},n.prototype.render=function(){var t;return t=this.model.get("works"),this.$(".related-research-loading").remove(),this.$el.css("visibility","hide").append(JST[this.template]({works:t.works})),this._truncateTitles(),this.$el.css("visibility",""),this},n.prototype._truncateTitles=function(){return this.$(".related-research-title").each(function(){return $(this).trunk8({lines:2,tooltip:!1})})},n}(Backbone.View)}.call(this),function(){SingleWork.RepoView=function(){function t(t){var e=this;this._set_repo_widths(),_.each(this.constructor_options,function(o){return e[o]=t[o]}),this.$container=$(this.container)}return t.prototype.constructor_options=["container","user","repo","identifier"],t.prototype.defaults={expanded:"966px",unexpanded:"760px"},t.prototype.show=function(){var t=this;return $a.ie8()?this.unsupported_browser():req("repo",function(){return t.$container.append("<div class='inner_repo'></div>"),t.$repo=t.$container.find(".inner_repo"),t.$repo.width(t.defaults.unexpanded),t.$repo.repo({user:t.user,name:t.repo}),t.$repo.on("not_found",function(){return t.not_found()}),t.$repo.on("api_limited",function(){return t.api_limited()})})},t.prototype.not_found=function(){var t;return null!=(t=this.$repo)&&t.find(".repo").hide(),this.$container.find(".not_found").show()},t.prototype.api_limited=function(){var t;return null!=(t=this.$repo)&&t.find(".repo").hide(),this.$container.find(".api_limited").show()},t.prototype.unsupported_browser=function(){var t;return null!=(t=this.$repo)&&t.find(".repo").hide(),this.$container.find(".unsupported_browser").show()},t.prototype.expand=function(){return this.$repo.width(this.defaults.expanded)},t.prototype.unexpand=function(){return this.$repo.width(this.defaults.unexpanded)},t.prototype.tear_down=function(){return this.$repo.remove()},t.prototype._set_repo_widths=function(){var t;return t=$.trim($("#site").attr("class").replace("fixed","")),"w_1160"===t?(this.defaults.expanded="1060px",this.defaults.unexpanded="880px"):"w_1340"===t?(this.defaults.expanded="1246px",this.defaults.unexpanded="1050px"):"w_1780"===t?(this.defaults.expanded="1680px",this.defaults.unexpanded="1500px"):void 0},t}()}.call(this),function(){this.JST||(this.JST={}),this.JST["single_work/templates/coauthor_request_toolbar"]=function(){var t=[];return t.push('<span class="coauthor-tag-request-prompt">You have been tagged as a co-author!</span><div class="coauthor-tag-request-actions pull-right"><span class="ignore-coauthor-tag-request clickable">IGNORE</span><button class="btn btn-lg btn-success accept-coauthor-tag-request"><span>ACCEPT</span></button></div>'),t.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["single_work/templates/coauthor_tag_suggestion_modal"]=function(){var t=[];return t.push('<div tabindex="-1" role="dialoge" aria-hidden="true" class="coauthor-tag-suggestions-modal modal fade"><div class="modal-dialog modal-sm"><div class="modal-content"><div class="modal-header text-center"><button aria-label="Close" data-dismiss="modal" class="close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title">Co-author Suggestions</h4></div><div class="modal-body text-center"><h5 class="current-state">Accepting your co-author suggestions...</h5></div></div></div></div>'),t.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["single_work/templates/related_works"]=function(t){var e,o=[],n=t||{};return function(t,n){0===n.length?o.push('<p class="text-center"><em class="text-gray">No other research found</em></p>'):(o.push("<div>"),function(){var t=n;if("number"==typeof t.length)for(var r=0,i=t.length;i>r;r++){var a=t[r];o.push("<a"+jade.attr("href",a.url,!0,!1)+jade.attr("title",a.title,!0,!1)+' class="related-research-item js-related-research-item"><div class="media"><div class="related-research-image pull-left valign-wrapper"><img width="60px" height="77px"'+jade.attr("src",a.scribd_thumbnail_url||"/images/scribd/document_thumbnail_fallback.svg",!0,!1)+' class="panel rectangle valign-item related-research-attachment-image"/></div><div class="media-body related-research-item-body valign-wrapper"><div class="related-research-title-wrapper valign-item"><div class="related-research-title text-gray-dark text-serif">'+jade.escape(null==(e=a.title)?"":e)+"</div></div></div></div></a>")}else{var i=0;for(var r in t){i++;var a=t[r];o.push("<a"+jade.attr("href",a.url,!0,!1)+jade.attr("title",a.title,!0,!1)+' class="related-research-item js-related-research-item"><div class="media"><div class="related-research-image pull-left valign-wrapper"><img width="60px" height="77px"'+jade.attr("src",a.scribd_thumbnail_url||"/images/scribd/document_thumbnail_fallback.svg",!0,!1)+' class="panel rectangle valign-item related-research-attachment-image"/></div><div class="media-body related-research-item-body valign-wrapper"><div class="related-research-title-wrapper valign-item"><div class="related-research-title text-gray-dark text-serif">'+jade.escape(null==(e=a.title)?"":e)+"</div></div></div></div></a>")}}}.call(this),o.push("</div>"))}.call(this,"undefined"in n?n.undefined:void 0,"works"in n?n.works:"undefined"!=typeof works?works:void 0),o.join("")}}.call(this),function(){SingleWork.PopoverController=function(){function t(t,e){this.pageload_at=t,this.wait_millis=e,this.notifier=new c.Server.Notification("sutd")}return t.prototype.timed_popover=function(){var t,e,o=this;return this.should_show_popover()?(t=function(){return o.check_cookies()?(o.show_popover(),o.notifier.notify({event_type:"popover_show",auvid:$auvid})):void 0},e=(new Date).getTime()-this.pageload_at.getTime(),e>=this.wait_millis?t():0>=e?setTimeout(t,this.wait_millis):setTimeout(t,this.wait_millis-e)):void 0},t.prototype.should_show_popover=function(){return $a.ie6()||$a.ie7()||$a.is_mobile()?!1:document.referrer?!!document.referrer.match(/https?:\/\/([^.]+\.)?(google|bing|yahoo|twitter|facebook|linkedin)\./):!0},t.prototype.check_cookies=function(){var t;return t=jQuery.cookie("ab_test_june_2012_5"),null!=t&&(t="true"===t),!t},t.prototype.show_popover=function(){return $("#overlay_background").css({opacity:".6"}).fadeIn(),SessionModal.DownloadWork.render()},t}()}.call(this);